{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "from bs4 import BeautifulSoup\n",
    "import requests\n",
    "import time, os\n",
    "from selenium import webdriver\n",
    "from selenium.webdriver.common.keys import Keys\n",
    "from selenium.webdriver.support.ui import Select\n",
    "from random_user_agent.user_agent import UserAgent\n",
    "from random_user_agent.params import SoftwareName, OperatingSystem\n",
    "import re\n",
    "import random\n",
    "import string\n",
    "from datetime import datetime\n",
    "from progressbar import ProgressBar\n",
    "import pandas as pd\n",
    "pbar = ProgressBar()\n",
    "import collections\n",
    "import matplotlib.pyplot as plt\n",
    "from sklearn.pipeline import Pipeline\n",
    "from sklearn.preprocessing import StandardScaler\n",
    "import pandas as pd\n",
    "import seaborn as sns\n",
    "from sklearn.model_selection import train_test_split"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "metadata": {},
   "outputs": [],
   "source": [
    "# you can also import SoftwareEngine, HardwareType, SoftwareType, Popularity from random_user_agent.params\n",
    "# you can also set number of user agents required by providing `limit` as parameter\n",
    "software_names = [SoftwareName.CHROME.value]\n",
    "operating_systems = [OperatingSystem.WINDOWS.value, OperatingSystem.LINUX.value]   \n",
    "user_agent_rotator = UserAgent(software_names=software_names, operating_systems=operating_systems, limit=100)\n",
    "# Get list of user agents.\n",
    "user_agents = user_agent_rotator.get_user_agents()\n",
    "user_agent = user_agent_rotator.get_random_user_agent()\n",
    "\n",
    "# Get Random User Agent String.\n",
    "def new_agent():\n",
    "    return user_agent_rotator.get_random_user_agent()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "metadata": {},
   "outputs": [],
   "source": [
    "chromedriver = \"/Applications/chromedriver\" # path to the chromedriver executable\n",
    "os.environ[\"webdriver.chrome.driver\"] = chromedriver\n",
    "reviews = \"https://apps.apple.com/us/app/hinge-dating-relationships/id595287172#see-all/reviews\"\n",
    "#user_agent = {'User-agent': user_agent}\n",
    "driver = webdriver.Chrome(chromedriver)\n",
    "driver.get(reviews)\n",
    "time.sleep(1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [],
   "source": [
    "elem = driver.find_element_by_tag_name(\"body\")\n",
    "\n",
    "no_of_pagedowns = (100000/10)\n",
    "\n",
    "while no_of_pagedowns:\n",
    "    elem.send_keys(Keys.PAGE_DOWN)\n",
    "    time.sleep(0.1)\n",
    "    no_of_pagedowns-=1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "metadata": {},
   "outputs": [],
   "source": [
    "html = driver.page_source\n",
    "soup = BeautifulSoup(html, 'html5lib')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 318,
   "metadata": {},
   "outputs": [],
   "source": [
    "review_data = []\n",
    "headers = ['app','time','stars','title','review']"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 319,
   "metadata": {},
   "outputs": [],
   "source": [
    "reviews = soup.findAll(attrs={\"class\": \"ember-view l-column--grid l-column small-12 medium-6 large-4 small-valign-top l-column--equal-height\"})\n",
    "for review in reviews:\n",
    "    time = review.find(class_=\"we-customer-review__date\").text\n",
    "    full_stars = review.find(class_ = \"we-star-rating ember-view we-customer-review__rating we-star-rating--large\").get('aria-label')\n",
    "    stars = re.search(r\"([0-5]) out of ([0-5])\",full_stars).group(1)\n",
    "    title = review.find(class_ = \"we-truncate we-truncate--single-line ember-view we-customer-review__title\").text.replace(\"\\n\", \" \")   \n",
    "    review_txt = review.find('blockquote',attrs={\"class\": \"we-truncate we-truncate--multi-line we-truncate--interactive we-truncate--truncated ember-view we-customer-review__body\"})\n",
    "    text = ' '.join([result.getText() for result in review_txt.findAll('p')])\n",
    "    \n",
    " #APPEND TO DICT\n",
    "    review_dict = dict(zip(headers, [  \n",
    "                                'hinge',\n",
    "                                time,\n",
    "                                stars,\n",
    "                                title,\n",
    "                                text\n",
    "                             ]))\n",
    "\n",
    "    review_data.append(review_dict)\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 323,
   "metadata": {},
   "outputs": [],
   "source": [
    "df_review_data = pd.DataFrame.from_dict(review_data)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 205,
   "metadata": {},
   "outputs": [],
   "source": [
    "df_review_data.to_csv('hinge.csv')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 324,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>app</th>\n",
       "      <th>time</th>\n",
       "      <th>stars</th>\n",
       "      <th>title</th>\n",
       "      <th>review</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>hinge</td>\n",
       "      <td>01/06/2020</td>\n",
       "      <td>4</td>\n",
       "      <td>3 improvements to help my dating sanity</td>\n",
       "      <td>1) A “close the flood gates” feature. The prob...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>hinge</td>\n",
       "      <td>11/05/2019</td>\n",
       "      <td>5</td>\n",
       "      <td>By far the best dating app out there</td>\n",
       "      <td>This app is one of the best dating apps out th...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>hinge</td>\n",
       "      <td>05/27/2019</td>\n",
       "      <td>5</td>\n",
       "      <td>Pretty sure I met The One on here</td>\n",
       "      <td>This is, by far, the class of all the availabl...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>hinge</td>\n",
       "      <td>06/04/2018</td>\n",
       "      <td>5</td>\n",
       "      <td>Great app! Just be patient with matches. It ...</td>\n",
       "      <td>I started using this app last summer. Met an g...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>hinge</td>\n",
       "      <td>03/15/2019</td>\n",
       "      <td>3</td>\n",
       "      <td>Great foundation, needs work</td>\n",
       "      <td>So to begin this review I want to point out th...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>hinge</td>\n",
       "      <td>10/21/2019</td>\n",
       "      <td>5</td>\n",
       "      <td>Met my match</td>\n",
       "      <td>I’ve tried all of the dating apps, no joke. I’...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>hinge</td>\n",
       "      <td>05/02/2019</td>\n",
       "      <td>5</td>\n",
       "      <td>Great app, will get better after a few updat...</td>\n",
       "      <td>This app has brought me more success and bette...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>hinge</td>\n",
       "      <td>02/26/2019</td>\n",
       "      <td>1</td>\n",
       "      <td>If you’re a guy, do not buy this app and her...</td>\n",
       "      <td>The app seems designed so that the guys fill u...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>hinge</td>\n",
       "      <td>11/27/2018</td>\n",
       "      <td>3</td>\n",
       "      <td>Amazing app but I’m having an awful experience</td>\n",
       "      <td>I REALLY want to love this app, but I am getti...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>hinge</td>\n",
       "      <td>12/17/2019</td>\n",
       "      <td>1</td>\n",
       "      <td>Algorithm is horrible and offensive</td>\n",
       "      <td>Well in theory their algorithm should be helpf...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "     app        time stars                                              title  \\\n",
       "0  hinge  01/06/2020     4           3 improvements to help my dating sanity    \n",
       "1  hinge  11/05/2019     5              By far the best dating app out there    \n",
       "2  hinge  05/27/2019     5                 Pretty sure I met The One on here    \n",
       "3  hinge  06/04/2018     5    Great app! Just be patient with matches. It ...   \n",
       "4  hinge  03/15/2019     3                      Great foundation, needs work    \n",
       "5  hinge  10/21/2019     5                                      Met my match    \n",
       "6  hinge  05/02/2019     5    Great app, will get better after a few updat...   \n",
       "7  hinge  02/26/2019     1    If you’re a guy, do not buy this app and her...   \n",
       "8  hinge  11/27/2018     3    Amazing app but I’m having an awful experience    \n",
       "9  hinge  12/17/2019     1               Algorithm is horrible and offensive    \n",
       "\n",
       "                                              review  \n",
       "0  1) A “close the flood gates” feature. The prob...  \n",
       "1  This app is one of the best dating apps out th...  \n",
       "2  This is, by far, the class of all the availabl...  \n",
       "3  I started using this app last summer. Met an g...  \n",
       "4  So to begin this review I want to point out th...  \n",
       "5  I’ve tried all of the dating apps, no joke. I’...  \n",
       "6  This app has brought me more success and bette...  \n",
       "7  The app seems designed so that the guys fill u...  \n",
       "8  I REALLY want to love this app, but I am getti...  \n",
       "9  Well in theory their algorithm should be helpf...  "
      ]
     },
     "execution_count": 324,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_review_data"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.5"
  },
  "toc": {
   "base_numbering": 1,
   "nav_menu": {},
   "number_sections": true,
   "sideBar": true,
   "skip_h1_title": false,
   "title_cell": "Table of Contents",
   "title_sidebar": "Contents",
   "toc_cell": false,
   "toc_position": {},
   "toc_section_display": true,
   "toc_window_display": false
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
